{
	email munaim.tahir@gmail.com

	log {
		output file /home/munaim/srv/proxy/caddy/logs/caddy.log
		format console
	}
}

# ============================================================
# PORTAL (Main Landing)
# ============================================================
# ============================================================
# RADREPORT / RIMS
# ============================================================
rims.alshifalab.pk {
	encode gzip zstd
	@backend_paths {
		path /api/* /admin/* /media/* /static/*
	}
	handle @backend_paths {
		reverse_proxy 127.0.0.1:8015 {
			header_up Host {host}
			header_up X-Real-IP {remote}
		}
	}
	handle {
		reverse_proxy 127.0.0.1:8081 {
			header_up Host {host}
			header_up X-Real-IP {remote}
		}
	}
}

api.rims.alshifalab.pk {
	encode gzip zstd
	reverse_proxy 127.0.0.1:8015 {
		header_up Host {host}
		header_up X-Real-IP {remote_host}
	}
}

# ============================================================
# LIMS (Laboratory Information Management System)
# ============================================================
lims.alshifalab.pk {
	encode gzip zstd
	header {
		Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
		X-Frame-Options "SAMEORIGIN"
		X-Content-Type-Options "nosniff"
		Referrer-Policy "strict-origin-when-cross-origin"
		-Server
	}
	reverse_proxy 127.0.0.1:8012 {
		header_up Host {host}
		header_up X-Real-IP {remote}
	}
}

api.lims.alshifalab.pk {
	encode gzip zstd
	reverse_proxy 127.0.0.1:8012 {
		header_up Host {host}
		header_up X-Real-IP {remote_host}
	}
}

# ============================================================
# SOS / ACCRED-AI
# ============================================================
sos.alshifalab.pk {
	encode gzip zstd
	route {
		reverse_proxy /api/* /admin/* /media/* 127.0.0.1:8017 {
			header_up Host {host}
			header_up X-Real-IP {remote}
		}
		reverse_proxy * 127.0.0.1:8083 {
			header_up Host {host}
			header_up X-Real-IP {remote}
		}
	}
}

# ============================================================
# FMU-PLATFORM (SIMS)
# ============================================================
sims.alshifalab.pk, sims.pmc.edu.pk {
	encode gzip zstd
	handle /api/* {
		reverse_proxy 127.0.0.1:8010 {
			header_up Host {host}
			header_up X-Real-IP {remote}
		}
	}
	handle /admin/* {
		reverse_proxy 127.0.0.1:8010 {
			header_up Host {host}
			header_up X-Real-IP {remote}
		}
	}
	handle {
		reverse_proxy 127.0.0.1:8080 {
			header_up Host {host}
			header_up X-Real-IP {remote}
		}
	}
}

api.sims.alshifalab.pk, api.sims.pmc.edu.pk {
	encode gzip zstd
	reverse_proxy 127.0.0.1:8010 {
		header_up Host {host}
		header_up X-Real-IP {remote_host}
	}
}

# ============================================================
# IP Redirects & Utilities
# ============================================================
http://34.16.82.13 {
	redir https://portal.alshifalab.pk{uri} permanent
}
