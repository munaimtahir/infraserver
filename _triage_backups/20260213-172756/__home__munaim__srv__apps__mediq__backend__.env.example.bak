# ============================================
# Backend Service - Environment Variables
# ============================================
# Copy this file to .env in the backend directory
# These variables are specific to the FastAPI backend service
# NEVER commit .env files to version control

# ============================================
# Application Settings
# ============================================
# Environment: dev, staging, prod, test
ENV=dev

# Logging level: DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_LEVEL=INFO

# ============================================
# Database Configuration
# ============================================
# SQLAlchemy connection string
# Format: postgresql+psycopg2://user:password@host:port/database
DATABASE_URL=postgresql+psycopg2://exam_user:change_me@postgres:5432/exam_platform

# ============================================
# Authentication & Security
# ============================================
# JWT secret key (use a strong, randomly generated value in production)
JWT_SECRET=change_me_super_secret

# JWT token expiration times
JWT_ACCESS_TTL_MIN=60
JWT_REFRESH_TTL_DAYS=30

# Token hashing pepper (preferred over TOKEN_PEPPER for auth tokens)
AUTH_TOKEN_PEPPER=change_me_token_pepper
# Legacy token pepper (used if AUTH_TOKEN_PEPPER not set)
TOKEN_PEPPER=change_me_token_pepper

# MFA (Multi-Factor Authentication)
# Fernet encryption key for encrypting TOTP secrets
# Generate with: docker run --rm python:3.11-slim sh -c "pip install cryptography --quiet && python -c 'from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())'"
# REQUIRED in production
MFA_ENCRYPTION_KEY=change_me_fernet_key

# ============================================
# CORS Configuration (deny-by-default, exact origins only, no wildcards)
# ============================================
# Public endpoints (e.g., health checks, public APIs)
CORS_ALLOW_ORIGINS_PUBLIC=
# App endpoints (frontend origins)
CORS_ALLOW_ORIGINS_APP=http://localhost:3000,http://localhost:3001
# Allowed HTTP methods
CORS_ALLOW_METHODS=GET,POST,PUT,PATCH,DELETE,OPTIONS
# Allowed request headers
CORS_ALLOW_HEADERS=Authorization,Content-Type,X-Request-ID
# Headers to expose to client
CORS_EXPOSE_HEADERS=X-Request-ID,X-Response-Time-ms,X-DB-Queries,X-DB-Time-ms
# Allow credentials (set true if using cookie auth)
CORS_ALLOW_CREDENTIALS=false
# Legacy: CORS_ORIGINS (merged with CORS_ALLOW_ORIGINS_APP for backward compatibility)
CORS_ORIGINS=http://localhost:3000

# ============================================
# Redis Configuration
# ============================================
# Redis connection URL for caching and session storage
REDIS_URL=redis://redis:6379/0
REDIS_PORT=6379

# ============================================
# Neo4j Graph Database
# ============================================
NEO4J_ENABLED=false
NEO4J_URI=bolt://neo4j:7687
NEO4J_USERNAME=neo4j
NEO4J_PASSWORD=change_me
NEO4J_DATABASE=neo4j
NEO4J_HTTP_PORT=7474
NEO4J_BOLT_PORT=7687

# ============================================
# Elasticsearch Configuration
# ============================================
ELASTICSEARCH_ENABLED=false
ELASTICSEARCH_URL=http://elasticsearch:9200
ELASTICSEARCH_INDEX_PREFIX=platform
ELASTICSEARCH_REQUEST_TIMEOUT_MS=2000
ELASTICSEARCH_BULK_BATCH_SIZE=500
ELASTICSEARCH_RETRY_MAX=5
# Optional: For secured Elasticsearch clusters
# ELASTICSEARCH_USERNAME=
# ELASTICSEARCH_PASSWORD=

# ============================================
# OAuth2/OIDC Configuration
# ============================================
# Google OAuth
OAUTH_GOOGLE_CLIENT_ID=change_me
OAUTH_GOOGLE_CLIENT_SECRET=change_me
OAUTH_GOOGLE_REDIRECT_URI=http://localhost:8000/v1/auth/oauth/google/callback

# Microsoft OAuth
OAUTH_MICROSOFT_CLIENT_ID=change_me
OAUTH_MICROSOFT_CLIENT_SECRET=change_me
OAUTH_MICROSOFT_REDIRECT_URI=http://localhost:8000/v1/auth/oauth/microsoft/callback
OAUTH_MICROSOFT_TENANT=common

# Frontend URL for OAuth redirects
FRONTEND_URL=http://localhost:3000
FRONTEND_BASE_URL=http://localhost:3000

# Allowed redirect URIs (comma-separated)
OAUTH_ALLOWED_REDIRECT_URIS=http://localhost:3000,http://localhost:8000

# ============================================
# Neo4j Graph Readiness Configuration
# ============================================
MIN_GRAPH_NODES=200
MIN_GRAPH_EDGES=100
GRAPH_SYNC_FRESHNESS_HOURS=24
GRAPH_ERROR_BUDGET_RUNS=3
FEATURE_GRAPH_ACTIVE=false

# ============================================
# Mock Ranking (Task 145): Python baseline + Go shadow/active
# ============================================
GO_RANKING_ENABLED=false
RANKING_GO_URL=http://ranking-go:8080
RANKING_PARITY_EPSILON=0.001
RANKING_PARITY_K=10
RANKING_ERROR_BUDGET_RUNS=3

# ============================================
# Security Headers
# ============================================
# Enable HSTS (only if ENV=prod and HTTPS guaranteed at edge)
ENABLE_HSTS=false
# Enable Content-Security-Policy (default false, can break embeds)
ENABLE_CSP=false

# ============================================
# Production Hardening (Performance & Reliability)
# ============================================
# Uvicorn worker configuration
# Workers formula: (2 * CPU cores) + 1
# For 1.5 CPU container: (2 * 1.5) + 1 = 4, using 5 as safe default
UVICORN_WORKERS=5
UVICORN_TIMEOUT_KEEP_ALIVE=5
UVICORN_LIMIT_CONCURRENCY=200
UVICORN_LIMIT_MAX_REQUESTS=10000

# Exam-time mode (disable heavy operations during exam spikes)
# When enabled: disables heavy analytics recompute, admin bulk jobs, defers background recalculations
EXAM_MODE=false

# ============================================
# Database Seeding
# ============================================
# Set to 'true' to skip automatic database seeding on startup
SKIP_SEED=false

# ============================================
# Snowflake Warehouse
# ============================================
# Snowflake integration is hard-disabled by default
# These variables are placeholders for future use
SNOWFLAKE_ENABLED=false
SNOWFLAKE_ACCOUNT=
SNOWFLAKE_USER=
SNOWFLAKE_PASSWORD=
SNOWFLAKE_WAREHOUSE=
SNOWFLAKE_DATABASE=
SNOWFLAKE_SCHEMA=RAW
FEATURE_ALLOW_SNOWFLAKE_CONNECT=false

# ============================================
# Notes
# ============================================
# - When running in Docker, use service names (postgres, redis, etc.)
# - When running locally, use localhost instead of service names
# - Never commit actual .env files with real secrets
# - For production, use strong, randomly generated secrets
# - Update all "change_me" placeholders with secure values
# - Ensure CORS_ORIGINS matches your frontend domain(s)
