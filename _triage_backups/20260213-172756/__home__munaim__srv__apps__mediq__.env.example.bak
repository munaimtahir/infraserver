# ============================================
# Exam Prep Platform - Environment Variables
# ============================================
# Copy this file to .env and update with your local values
# NEVER commit .env files to version control

# ============================================
# Global Configuration
# ============================================
ENV=development

# ============================================
# PostgreSQL Database
# ============================================
POSTGRES_DB=exam_platform
POSTGRES_USER=exam_user
POSTGRES_PASSWORD=change_me
POSTGRES_HOST=postgres
POSTGRES_PORT=5432

# ============================================
# Backend (FastAPI)
# ============================================
BACKEND_PORT=8000

# Database connection string (SQLAlchemy format)
DATABASE_URL=postgresql+psycopg2://exam_user:change_me@postgres:5432/exam_platform

# JWT Authentication
JWT_SECRET=change_me_super_secret
JWT_ACCESS_TTL_MIN=60
JWT_REFRESH_TTL_DAYS=30
# Token hashing pepper (preferred over TOKEN_PEPPER for auth tokens)
AUTH_TOKEN_PEPPER=change_me_token_pepper
# Legacy token pepper (used if AUTH_TOKEN_PEPPER not set)
TOKEN_PEPPER=change_me_token_pepper

# MFA (Multi-Factor Authentication)
# Fernet encryption key for encrypting TOTP secrets
# Generate with: docker run --rm python:3.11-slim sh -c "pip install cryptography --quiet && python -c 'from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())'"
# REQUIRED in production
MFA_ENCRYPTION_KEY=change_me_fernet_key

# CORS Configuration (deny-by-default, exact origins only, no wildcards)
# Public endpoints (e.g., health checks, public APIs)
CORS_ALLOW_ORIGINS_PUBLIC=
# App endpoints (frontend origins)
CORS_ALLOW_ORIGINS_APP=http://localhost:3000,http://localhost:3001
# Allowed HTTP methods
CORS_ALLOW_METHODS=GET,POST,PUT,PATCH,DELETE,OPTIONS
# Allowed request headers
CORS_ALLOW_HEADERS=Authorization,Content-Type,X-Request-ID
# Headers to expose to client
CORS_EXPOSE_HEADERS=X-Request-ID,X-Response-Time-ms,X-DB-Queries,X-DB-Time-ms
# Allow credentials (set true if using cookie auth)
CORS_ALLOW_CREDENTIALS=false
# Legacy: CORS_ORIGINS (merged with CORS_ALLOW_ORIGINS_APP for backward compatibility)
CORS_ORIGINS=http://localhost:3000

# Logging
LOG_LEVEL=INFO

# ============================================
# Redis
# ============================================
REDIS_URL=redis://redis:6379/0
REDIS_PORT=6379

# ============================================
# Neo4j Graph Database
# ============================================
NEO4J_ENABLED=false
NEO4J_URI=bolt://neo4j:7687
NEO4J_USERNAME=neo4j
NEO4J_PASSWORD=change_me
NEO4J_DATABASE=neo4j
NEO4J_HTTP_PORT=7474
NEO4J_BOLT_PORT=7687

# ============================================
# Elasticsearch
# ============================================
ELASTICSEARCH_ENABLED=false
ELASTICSEARCH_URL=http://elasticsearch:9200
ELASTICSEARCH_INDEX_PREFIX=platform
ELASTICSEARCH_REQUEST_TIMEOUT_MS=2000
ELASTICSEARCH_BULK_BATCH_SIZE=500
ELASTICSEARCH_RETRY_MAX=5
# Optional: For secured Elasticsearch clusters
# ELASTICSEARCH_USERNAME=
# ELASTICSEARCH_PASSWORD=

# ============================================
# Frontend (Next.js)
# ============================================
FRONTEND_PORT=3000

# Public API URL (accessible from browser)
NEXT_PUBLIC_API_BASE_URL=http://localhost:8000/v1
NEXT_PUBLIC_APP_NAME=Exam Prep Platform
NEXT_PUBLIC_ENV=development
NEXT_PUBLIC_FEATURE_STUDENT_CONCEPT_EXPLORER=false

# ============================================
# Neo4j Graph Readiness Configuration
# ============================================
MIN_GRAPH_NODES=200
MIN_GRAPH_EDGES=100
GRAPH_SYNC_FRESHNESS_HOURS=24
GRAPH_ERROR_BUDGET_RUNS=3
FEATURE_GRAPH_ACTIVE=false

# ============================================
# Mock Ranking (Task 145): Python baseline + Go shadow/active
# ============================================
GO_RANKING_ENABLED=false
RANKING_GO_URL=http://ranking-go:8080
RANKING_PARITY_EPSILON=0.001
RANKING_PARITY_K=10
RANKING_ERROR_BUDGET_RUNS=3

# ============================================
# Security Headers
# ============================================
# Enable HSTS (only if ENV=prod and HTTPS guaranteed at edge)
ENABLE_HSTS=false
# Enable Content-Security-Policy (default false, can break embeds)
ENABLE_CSP=false

# ============================================
# Production Hardening (Performance & Reliability)
# ============================================
# Uvicorn worker configuration
# Workers formula: (2 * CPU cores) + 1
# For 1.5 CPU container: (2 * 1.5) + 1 = 4, using 5 as safe default
UVICORN_WORKERS=5
UVICORN_TIMEOUT_KEEP_ALIVE=5
UVICORN_LIMIT_CONCURRENCY=200
UVICORN_LIMIT_MAX_REQUESTS=10000

# Exam-time mode (disable heavy operations during exam spikes)
# When enabled: disables heavy analytics recompute, admin bulk jobs, defers background recalculations
EXAM_MODE=false

# PostgreSQL shared_buffers (25% of memory limit)
# For 2GB memory limit: shared_buffers = 512MB
POSTGRES_SHARED_BUFFERS=512MB

# ============================================
# Notes
# ============================================
# - For production, use strong, randomly generated secrets
# - Update all "change_me" placeholders with secure values
# - Ensure CORS_ORIGINS matches your frontend domain(s)
# - Database URLs should use service names (postgres, redis) when running in Docker
# - For local development outside Docker, use localhost instead of service names

# ============================================
# Database Seeding (Backend)
# ============================================
# Set to 'true' to skip automatic database seeding on startup
SKIP_SEED=false

# ============================================
# Snowflake Warehouse (Backend)
# ============================================
# Snowflake integration is hard-disabled by default
# These variables are placeholders for future use
SNOWFLAKE_ENABLED=false
SNOWFLAKE_ACCOUNT=
SNOWFLAKE_USER=
SNOWFLAKE_PASSWORD=
SNOWFLAKE_WAREHOUSE=
SNOWFLAKE_DATABASE=
SNOWFLAKE_SCHEMA=RAW
FEATURE_ALLOW_SNOWFLAKE_CONNECT=false
